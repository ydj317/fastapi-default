{% extends "layout/default.j2" %}

{% block title %}회원가입{% endblock %}

{% block content %}
    <h1>회원가입</h1>
    <form onsubmit="handleJoin(event)">
        <!-- 아이디 -->
        <div>
            <label for="username">아이디:</label>
            <input type="text" id="username" name="username" maxlength="50" required>
        </div>

        <!-- 비밀번호 -->
        <div>
            <label for="password">비밀번호:</label>
            <input type="password" id="password" name="password" maxlength="200" required>
        </div>

        <!-- 닉네임 -->
        <div>
            <label for="nickname">닉네임:</label>
            <input type="text" id="nickname" name="nickname" maxlength="50">
        </div>

        <!-- 이름 -->
        <div>
            <label for="fullname">이름:</label>
            <input type="text" id="fullname" name="fullname" maxlength="100">
        </div>

        <!-- 생년월일 -->
        <div>
            <label for="birth_date">생년월일:</label>
            <input type="date" id="birth_date" name="birth_date">
        </div>

        <!-- 휴대폰 -->
        <div>
            <label for="mobile">휴대폰:</label>
            <input type="tel" id="mobile" name="mobile" maxlength="20" placeholder="010-1234-5678">
        </div>

        <!-- 전화번호 -->
        <div>
            <label for="telephone">전화번호:</label>
            <input type="tel" id="telephone" name="telephone" maxlength="20" placeholder="02-123-4567">
        </div>

        <!-- 우편번호 -->
        <div>
            <label for="zipcode">우편번호:</label>
            <input type="text" id="zipcode" name="zipcode" maxlength="10">
            <button type="button">우편번호 찾기</button>
        </div>

        <!-- 주소 -->
        <div>
            <label for="address1">주소:</label>
            <input type="text" id="address1" name="address1" maxlength="200">
        </div>

        <!-- 상세주소 -->
        <div>
            <label for="address2">상세주소:</label>
            <input type="text" id="address2" name="address2" maxlength="200">
        </div>

        <!-- 이메일 -->
        <div>
            <label for="email">이메일:</label>
            <input type="email" id="email" name="email" maxlength="100" placeholder="user@example.com">
        </div>

        <!-- 이메일 수신동의 -->
        <div>
            <label>
                <input type="checkbox" id="email_consent" name="email_consent" value="T">
                이메일 수신 동의
            </label>
        </div>

        <!-- SMS 수신동의 -->
        <div>
            <label>
                <input type="checkbox" id="sms_consent" name="sms_consent" value="T">
                SMS 수신 동의
            </label>
        </div>

        <!-- 추천인 아이디 -->
        <div>
            <label for="referrer_username">추천인 아이디:</label>
            <input type="text" id="referrer_username" name="referrer_username" maxlength="50">
        </div>

        <!-- 제출 버튼 -->
        <div>
            <button type="submit">회원가입</button>
        </div>
    </form>

{% endblock %}

{% block foot %}
    <script>
        async function handleLogin(event) {
            event.preventDefault();

            const formData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                nickname: document.getElementById('nickname').value
            };

            try {
                const response = await fetch('/api/user/join', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.code === 200) {
                    alert('Joined!')
                    window.location.href = '/';
                } else {
                    alert('Join failed: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Join failed: ' + error.message);
            }
        }
    </script>
{% endblock %}